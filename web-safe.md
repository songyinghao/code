# web 安全性规范

## 前言

这里简单地列出了一份清单，可以按照清单的内容改进系统的安全性。

总的思想：

* 木桶原理（系统的安全性取决于安全性最低的模块）。
* 客户端的所有请求都是不可信任的，甚至有害的。

## 代码安全

* 服务端的源码、配置文件和备份文件等文件应该不能被直接访问。

## 输入验证

客户端需要对用户输入进行校验，从而减轻服务器*压力和提高用户体验。

* 是否依赖客户端的验证（客户端的校验都是不可信的，服务端需要重新校验所有的参数）
* 是否校验了所有的参数
* 重要的运算和算法不要在客户端运行。

* 输入的数据没有进行有效的控制和验证
数据类型（字符串，整型，实数，等）
允许的字符集
最小和最大的长度
是否允许空输入
参数是否是必须的
重复是否允许
数值范围
特定的值（枚举型）
特定的模式（正则表达式）（注：建议尽量采用白名单）

### 文件上传

* 是否格式限制（严格的做法是不仅仅通过文件名来判断文件格式）
* 是否大小限制


## 权限验证

* 每个资源（页面、接口或者文件，下同）的访问需不需要权限才能访问。
* 没有登录、口令过期失效后或注销登录后，直接输入登录后才能查看的页面的网址（含跳转页面），能直接打开页面
* 正常登录后，直接输入自己没有权限查看的页面的网址，可以打开页面。
* 注销后，点浏览器上的后退，是否可以进行操作。
* 密码/口令输入框避免明码显示密码
* 必须测试有效和无效的用户名和密码
* 要注意是否存在大小写敏感
* 是否有校验码
* 用户登陆后在一定时间内（例如15 分钟）没有点击任何页面，是否需要重新登陆才能正常使用。
* 是否设置密码最小长度（密码强度）
* 用户名和密码中是否可以有空格或回车？
* 在线超时：Web应用系统是否有超时的限制，也就是说，用户登陆一定时间内（例如15分钟）没有点击任何页面，是否需要重新登陆才能正常使用。
* 避免研发只是简单的在客户端不显示权限高的功能项

登陆密码防暴力破解：

* 密码错误次数限制。
* 输错 N 次密码后需要输入验证码。
* 连续五次输入错误后，该用户的ip地址将被封，可以在一段时间后自动解封或者后台管理员手动解封

防恶意注册（机器注册）：

* 通过复杂验证注册（如验证码等）。
* 通过邮箱、手机号验证，验证成功才能注册。
* 单 IP 注册频率限制。

## cookie 安全

* cookie 中是否含有用户名、密码、userid 等关键信息。
* 重要数据需要用 cookie 存储时加密存储。
* 给 Cookie 加上 HttpOnly 标记。

## 存储安全

存储包括数据库存储等存储方式。

* 重要信息（如身份证号、信用卡号等）加密存储，采用什么算法，秘钥如何保存
* 如果安全性要求不高，数据库密码推荐采用 md5(密码 + 盐值) 的方式存储，单单用 md5 是不安全的。盐值不应该保存在数据库，且不能太短或者太过于简单。

## 数据传输安全

数据传输安全主要是防止重要数据被窃取和修改。

* 避免在参数过程中传递敏感数据
* 地址栏中不可以看到刚才填写的密码
* 敏感数据传输过程需要加密（使用 HTTPs 协议或采用其他算法加密）

## 日志安全

* 操作留痕：为了保证Web应用系统的安全性，日志文件是至关重要的。需要测试相关信息是否写进入了日志文件，是否可追踪。
* 日志文件是否安全储存。
* 管理日志必须在近几日无法被删除。

## 异常处理

系统发生异常、错误时，避免将异常、错误信息暴露给客户端（如 500 页面出现异常信息）

## 数据备份与恢复

* 当系统程序文件丢失时，能否恢复。
* 备份文件是否安全存储。

## 其他

* 后台入口是否隐秘（不要愚蠢地将入口暴露在前台页面中，不要使用容易被猜测到的后台入口地址，切莫将后台地址写入robots）。
* robots 协议是不安全的，不要将后台管理入口等私密链接写到 robots.txt 里面。
* 是否保证配置存储的安全

## 常见攻击及其解决方法

### SQL 注入攻击

避免 sql 直接拼接。

### XSS 攻击

* 对包含特殊字符（<  >  '  ''  /  &  \）的输入进行过滤或者转义
* 不要引入任何不可信的第三方 JavaScript （比如广告插件等）到页面里
* 给 Cookie 加上 HttpOnly 标记

### CSRF 攻击

* 隐藏域随机值
* 验证码

### 会话劫持

略。


